@echo off
:: Ultimate Malware Scanner - Full System Check
:: Generates summary.txt and report.txt

title Ultimate Malware Scanner
color 0A
setlocal enabledelayedexpansion

:: Clear old reports
del "summary.txt" 2>nul
del "report.txt" 2>nul

:: Admin check
net session >nul 2>&1
if %ERRORLEVEL% NEQ 0 (
    echo [!] ERROR: Run as Administrator >> "summary.txt"
    echo [!] ERROR: This scan requires Administrator privileges. >> "report.txt"
    goto :end
)

echo [*] Starting Ultimate Malware Scan... >> "report.txt"
echo ==================================== >> "report.txt"
echo SCAN STARTED: %date% %time% >> "report.txt"
echo ==================================== >> "report.txt"

:: ----------------------------
:: 1. DRIVE SCAN (All Partitions)
:: ----------------------------
echo [DRIVE SCAN] Checking all partitions... >> "report.txt"
for /f "skip=1 delims=" %%d in ('wmic logicaldisk get caption') do (
    set "drive=%%d"
    if exist "%%d\" (
        echo ---------------------------- >> "report.txt"
        echo SCANNING DRIVE: %%d >> "report.txt"
        echo ---------------------------- >> "report.txt"
        
        :: Suspicious files
        echo [FILES] EXE/DLL/VBS/PS1/BAT >> "report.txt"
        dir /s /a /b "%%d\*.exe" "%%d\*.dll" "%%d\*.vbs" "%%d\*.ps1" "%%d\*.bat" ^
            | findstr /i "njrat darkcomet poisonivy meterpreter cobalt strike payload" >> "report.txt"
        
        :: Hidden/System files
        echo. >> "report.txt"
        echo [SYSTEM] Suspicious system files >> "report.txt"
        dir /s /a /b "%%d\Windows\System32\*.exe" ^
            | findstr /i "svchost.exe lsass.exe winlogon.exe" >> "report.txt"
    )
)

:: ----------------------------
:: 2. PROCESS SCAN
:: ----------------------------
echo. >> "report.txt"
echo ==================================== >> "report.txt"
echo [PROCESS SCAN] Running processes >> "report.txt"
echo ==================================== >> "report.txt"
tasklist | findstr /i "njrat darkcomet poisonivy meterpreter cobalt strike" >> "report.txt"

:: ----------------------------
:: 3. NETWORK SCAN
:: ----------------------------
echo. >> "report.txt"
echo ==================================== >> "report.txt"
echo [NETWORK SCAN] Active connections >> "report.txt"
echo ==================================== >> "report.txt"
netstat -ano | findstr "ESTABLISHED" | findstr /v "127.0.0.1" >> "report.txt"

:: ----------------------------
:: 4. REGISTRY SCAN (Malware persistence)
:: ----------------------------
echo. >> "report.txt"
echo ==================================== >> "report.txt"
echo [REGISTRY SCAN] Startup entries >> "report.txt"
echo ==================================== >> "report.txt"
reg query "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run" >> "report.txt"
reg query "HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Run" >> "report.txt"

:: ----------------------------
:: 5. SCHEDULED TASKS SCAN
:: ----------------------------
echo. >> "report.txt"
echo ==================================== >> "report.txt"
echo [TASK SCAN] Suspicious tasks >> "report.txt"
echo ==================================== >> "report.txt"
schtasks /query /fo list | findstr /i "update startup temp" >> "report.txt"

:: ----------------------------
:: GENERATE SUMMARY
:: ----------------------------
echo SCAN COMPLETED: %date% %time% > "summary.txt"
echo ==================================== >> "summary.txt"
echo [SUMMARY] >> "summary.txt"
echo. >> "summary.txt"

:: Count suspicious files
set /a suspicious=0
for /f "tokens=3" %%a in ('find /c /i "exe" "report.txt"') do set /a suspicious+=%%a
for /f "tokens=3" %%a in ('find /c /i "dll" "report.txt"') do set /a suspicious+=%%a

echo Suspicious files found: !suspicious! >> "summary.txt"

:: Count malicious processes
set /a bad_procs=0
for /f "tokens=3" %%a in ('find /c /i "njrat" "report.txt"') do set /a bad_procs+=%%a
for /f "tokens=3" %%a in ('find /c /i "darkcomet" "report.txt"') do set /a bad_procs+=%%a

echo Malicious processes: !bad_procs! >> "summary.txt"

:: Count suspicious network connections
set /a bad_conn=0
for /f "tokens=3" %%a in ('find /c /i "ESTABLISHED" "report.txt"') do set /a bad_conn+=%%a

echo Suspicious connections: !bad_conn! >> "summary.txt"

:: ----------------------------
:: FINAL OUTPUT
:: ----------------------------
:end
echo. >> "summary.txt"
echo Reports generated: >> "summary.txt"
echo - summary.txt (Quick Overview) >> "summary.txt"
echo - report.txt (Full Details) >> "summary.txt"
echo. >> "summary.txt"
echo [!] Review report.txt for complete scan details. >> "summary.txt"

:: Show completion message
cls
type "summary.txt"
echo.
echo [âœ“] Scan complete. Reports saved to:
echo     - summary.txt (Quick Overview)
echo     - report.txt (Full Details)
pause
