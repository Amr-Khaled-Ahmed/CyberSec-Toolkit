@echo off
:: Deep Malware Scan - Checks all drives (C:, D:, etc.)
:: Requires Admin privileges for full scan

title Deep Malware Scan (All Drives)
color 0A
echo.
echo ########################################################
echo #               DEEP MALWARE SCAN (ALL DRIVES)         #
echo #  Scans C:\, D:\, etc. for viruses, RATs, and threats #
echo ########################################################
echo.
echo [*] Checking system requirements...

:: Check if running as Admin
net session >nul 2>&1
if %ERRORLEVEL% NEQ 0 (
    echo [!] ERROR: This scan requires Administrator privileges.
    echo [!] Right-click and select "Run as Administrator".
    pause
    exit /b 1
)

:: Get all available drives
echo.
echo [*] Detecting available drives...
for /f "skip=1 delims=" %%d in ('wmic logicaldisk get caption') do (
    set "drive=%%d"
    if exist "%%d\" (
        echo [✓] Found drive: %%d
        set "drives=!drives! %%d"
    )
)

:: Scan each drive for malware
echo.
echo [*] Starting deep malware scan (this may take a while)...
for %%d in (%drives%) do (
    echo.
    echo ===== SCANNING DRIVE: %%d =====
    
    :: Check for known malware files
    echo.
    echo [FILE SCAN] Checking for suspicious executables...
    dir /s /b "%%d\*.exe" "%%d\*.dll" "%%d\*.vbs" "%%d\*.bat" "%%d\*.ps1" | findstr /i "njrat darkcomet poisonivy meterpreter cobalt strike payload"
    
    :: Check hidden/System32 malware
    echo.
    echo [SYSTEM SCAN] Checking System32 and hidden files...
    dir /a /s "%%d\Windows\System32\*.exe" | findstr /i "svchost.exe lsass.exe winlogon.exe"
    
    :: Check autorun malware
    echo.
    echo [AUTORUN SCAN] Checking autorun entries...
    dir /s /b "%%d\autorun.inf" "%%d\*.lnk"
)

:: Check running processes
echo.
echo ===== PROCESS SCAN =====
tasklist | findstr /i "njrat darkcomet poisonivy meterpreter cobalt strike"

:: Check network connections
echo.
echo ===== NETWORK SCAN =====
netstat -ano | findstr /i "ESTABLISHED" | findstr /v "127.0.0.1"

:: Check scheduled tasks (common malware persistence)
echo.
echo ===== SCHEDULED TASKS SCAN =====
schtasks /query /fo list | findstr /i "update startup temp"

echo.
echo [✓] Deep scan completed. Review results above.
echo [!] If suspicious files/processes found, investigate further.
pause
