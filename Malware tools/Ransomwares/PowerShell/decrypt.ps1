# =============================
# File: decrypt.ps1
# =============================

$TargetFolder = "$env:USERPROFILE\Desktop\VictimFiles"
$KeyFile = "$env:USERPROFILE\Desktop\aes_key.bin"
$IVFile = "$env:USERPROFILE\Desktop\aes_iv.bin"

# Validate key files
if (!(Test-Path $KeyFile -and (Test-Path $IVFile))) {
    Write-Error "[-] Missing key or IV file. Cannot decrypt."
    exit
}

# Load AES key and IV
$Key = [IO.File]::ReadAllBytes($KeyFile)
$IV = [IO.File]::ReadAllBytes($IVFile)
$AES = [System.Security.Cryptography.Aes]::Create()
$AES.Key = $Key
$AES.IV = $IV

# Decrypt all encrypted files
Get-ChildItem -Path $TargetFolder -Filter "*.ENCRYPTED" | ForEach-Object {
    $encData = [IO.File]::ReadAllBytes($_.FullName)
    $decryptor = $AES.CreateDecryptor()
    $plain = $decryptor.TransformFinalBlock($encData, 0, $encData.Length)
    $original = $_.FullName -replace '\.ENCRYPTED$',''
    [IO.File]::WriteAllBytes($original, $plain)
    Remove-Item $_.FullName -Force
    Write-Host "[-] Decrypted: $(Split-Path $original -Leaf)"
}

Write-Host "`n[*] Decryption simulation complete."
